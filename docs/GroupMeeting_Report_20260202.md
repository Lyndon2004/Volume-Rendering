# 水团追踪可视化系统 - 组会汇报

**汇报人：** 林宇泉  
**日期：** 2026年2月2日  
**项目状态：** 第一、二阶段完成，进入测试与UI开发阶段

---

## 一、项目背景回顾

基于 1月19日与海洋系的讨论，研究者提出了以下核心需求：
1. **从"看场"到"看物体"**：不需要在数据内部漫游，而是追踪特定水团的边界和轨迹。
2. **多变量定义水团**：水团由温度、盐度、溶解氧等多个变量的阈值范围共同界定。
3. **长时序性能优化**：需要流畅展示跨度几十年的数据变化。

---

## 二、已完成工作

### ✅ 第一阶段：数据处理后端（Python）

| 模块 | 功能 | 文件 |
|------|------|------|
| 数据加载器 | 解析 `.raw.ini` 配置，加载多变量体数据 | `volume_loader.py` |
| 等值面提取 | 使用 Marching Cubes 算法将体数据转换为轻量 3D 模型 | `extract_isosurface.py` |
| 轨迹计算 | 自动计算每帧水团质心坐标 | `calculate_trajectory.py` |
| **多变量融合处理器** | 支持布尔逻辑公式定义水团，如 `(chloro > 50) & (salt < 35)` | `multi_var_processor.py` |

**产出物：**
- `.obj` 3D 模型序列（每帧一个文件）
- `trajectory.json` 轨迹数据（含质心坐标、体积等）

### ✅ 第二阶段：可视化前端（Unity）

| 模块 | 功能 | 文件 |
|------|------|------|
| 总控制器 | 读取 JSON、协调各组件同步播放 | `WaterMassManager.cs` |
| 模型播放器 | 运行时加载 .obj，实现定格动画式播放 | `MeshSequencePlayer.cs` |
| 轨迹渲染器 | 绘制质心移动路径，蓝→红渐变表示时间 | `TrajectoryRenderer.cs` |
| OBJ 加载器 | 轻量级运行时 OBJ 解析工具 | `SimpleObjLoader.cs` |

---

## 三、技术亮点

1. **数据轻量化**  
   原始体数据 GB 级别 → 提取后的 Mesh 仅 MB 级别  
   实现 **50 年数据秒级加载**

2. **多变量布尔逻辑**  
   支持灵活定义水团：`(Temp < 10) & (Salt > 34) & (O2 < 200)`  
   一次处理，生成完整动画序列

3. **轨迹可视化**  
   将时间信息空间化，一眼看出水团"从哪来、到哪去"

---

## 四、下一步计划

### 近期（本周）
- [ ] **Unity 集成测试**：在 Unity 中组装组件，验证数据流通畅
- [ ] **生成测试数据**：用现有叶绿素/NO3/盐度数据跑一次完整流程

### 中期（2周内）
- [ ] **第三阶段：UI 开发**
  - 时间轴滑块（支持拖拽播放）
  - 2D 图表面板（显示体积随时间变化）
  - 阈值编辑器（实时调整水团定义参数）

### 远期（可选优化）
- [ ] 幽灵/洋葱皮效果：显示前几帧的淡出轮廓
- [ ] LOD 多细节层次：快速拖动时用低精度模型
- [ ] 水团分裂追踪：当水团分裂时自动识别并标记

---

## 五、需要讨论的问题

1. **阈值参数**：海洋系能否提供"模态水"的具体定义？（温度/盐度/氧气范围）
2. **数据对齐**：目前假设各变量空间分辨率一致，是否需要额外的插值对齐？
3. **优先级**：UI 功能中，哪个对研究者最重要？（时间轴 / 图表 / 参数编辑器）

---

## 六、演示（如有时间）

可在会上演示：
1. Python 脚本处理数据 → 生成 `.obj` 和 `.json`
2. Unity 中加载并播放水团动画
